<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Matter.js Car Example â€” Stable</title>
  <style>
    body { margin: 0; overflow: hidden; }
    canvas { display: block; }
  </style>
</head>
<body>
<script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.20.0/matter.min.js"></script>
<script>
  const { Engine, Render, Runner, World, Bodies, Composite, Composites, Body, Events } = Matter;

  const engine = Engine.create();
  const world = engine.world;

  const render = Render.create({
    element: document.body,
    engine: engine,
    options: { width: 800, height: 400, wireframes: false, background: '#222' }
  });
  Render.run(render);
  Runner.run(Runner.create(), engine);
// Function to follow the car smoothly
function updateCamera() {
  const margin = 200; // how much ahead of the car to show
  const left = car.position.x - margin;
  Render.lookAt(render, {
    min: { x: left, y: 0 },
    max: { x: left + render.options.width, y: render.options.height }
  });
}

  // Terrain: Use stack of rectangles
  const cols = 50, w = 1600, ch = 20;
  for (let i = 0; i < cols; i++) {
    const body = Bodies.rectangle(16 * i, 380, 32, 40 + Math.random()*120, { isStatic: true, render: { fillStyle: '#444' } });
    World.add(world, body);
  }

  // Use Matter.js built-in 'car' composite (deprecated but works)
  const car = Composites.car(150, 200, 80, 30, 20);
  World.add(world, car);

  // Controls: drive the car
  const speed = 0.03;
  Events.on(engine, 'beforeUpdate', () => {
    if (key.right) Body.applyForce(car.bodies[1], car.bodies[1].position, { x: speed, y: 0 });
    if (key.left) Body.applyForce(car.bodies[2], car.bodies[2].position, { x: -speed, y: 0 });
  });
updateCamera();

  const key = { left: false, right: false };
  window.addEventListener('keydown', e => { if (e.code === 'ArrowRight') key.right = true; if (e.code === 'ArrowLeft') key.left = true; });
  window.addEventListener('keyup', e => { if (e.code === 'ArrowRight') key.right = false; if (e.code === 'ArrowLeft') key.left = false; });

  console.log("Use left/right arrows to drive");
Events.on(engine, 'afterUpdate', () => {
  addTerrain(car.position.x + 800);
  const dist = Math.max(0, Math.floor(car.position.x - CAR_START_X));
  hud.textContent = `Distance: ${dist} m`;

  // ** Add this to make the camera follow the car **
  const margin = 200;
  const left = car.position.x - margin;
  Render.lookAt(render, {
    min: { x: left, y: 0 },
    max: { x: left + W, y: H }
  });
});

</script>
</body>
</html>
